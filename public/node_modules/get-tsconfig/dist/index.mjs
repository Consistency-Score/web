import d from"path";import U from"fs";import{createRequire as I}from"module";function _(r){const a=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return a||n?r:r.replace(/\\/g,"/")}function z(r,a){for(;;){const n=d.join(r,a);if(U.existsSync(n))return _(n);const e=d.dirname(r);if(e===r)return;r=e}}var $=I(import.meta.url);function H(r,a){a===void 0&&(a=!1);var n=r.length,e=0,i="",u=0,t=16,f=0,s=0,v=0,p=0,c=0;function A(o,b){for(var C=0,m=0;C<o||!b;){var h=r.charCodeAt(e);if(h>=48&&h<=57)m=m*16+h-48;else if(h>=65&&h<=70)m=m*16+h-65+10;else if(h>=97&&h<=102)m=m*16+h-97+10;else break;e++,C++}return C<o&&(m=-1),m}function N(o){e=o,i="",u=0,t=16,c=0}function D(){var o=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&w(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&w(r.charCodeAt(e)))for(e++;e<r.length&&w(r.charCodeAt(e));)e++;else return c=3,r.substring(o,e);var b=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&w(r.charCodeAt(e))){for(e++;e<r.length&&w(r.charCodeAt(e));)e++;b=e}else c=3;return r.substring(o,b)}function S(){for(var o="",b=e;;){if(e>=n){o+=r.substring(b,e),c=2;break}var C=r.charCodeAt(e);if(C===34){o+=r.substring(b,e),e++;break}if(C===92){if(o+=r.substring(b,e),e++,e>=n){c=2;break}var m=r.charCodeAt(e++);switch(m){case 34:o+='"';break;case 92:o+="\\";break;case 47:o+="/";break;case 98:o+="\b";break;case 102:o+="\f";break;case 110:o+=`
`;break;case 114:o+="\r";break;case 116:o+="	";break;case 117:var h=A(4,!0);h>=0?o+=String.fromCharCode(h):c=4;break;default:c=5}b=e;continue}if(C>=0&&C<=31)if(P(C)){o+=r.substring(b,e),c=2;break}else c=6;e++}return o}function y(){if(i="",c=0,u=e,s=f,p=v,e>=n)return u=n,t=17;var o=r.charCodeAt(e);if(B(o)){do e++,i+=String.fromCharCode(o),o=r.charCodeAt(e);while(B(o));return t=15}if(P(o))return e++,i+=String.fromCharCode(o),o===13&&r.charCodeAt(e)===10&&(e++,i+=`
`),f++,v=e,t=14;switch(o){case 123:return e++,t=1;case 125:return e++,t=2;case 91:return e++,t=3;case 93:return e++,t=4;case 58:return e++,t=6;case 44:return e++,t=5;case 34:return e++,i=S(),t=10;case 47:var b=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!P(r.charCodeAt(e));)e++;return i=r.substring(b,e),t=12}if(r.charCodeAt(e+1)===42){e+=2;for(var C=n-1,m=!1;e<C;){var h=r.charCodeAt(e);if(h===42&&r.charCodeAt(e+1)===47){e+=2,m=!0;break}e++,P(h)&&(h===13&&r.charCodeAt(e)===10&&e++,f++,v=e)}return m||(e++,c=1),i=r.substring(b,e),t=13}return i+=String.fromCharCode(o),e++,t=16;case 45:if(i+=String.fromCharCode(o),e++,e===n||!w(r.charCodeAt(e)))return t=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=D(),t=11;default:for(;e<n&&k(o);)e++,o=r.charCodeAt(e);if(u!==e){switch(i=r.substring(u,e),i){case"true":return t=8;case"false":return t=9;case"null":return t=7}return t=16}return i+=String.fromCharCode(o),e++,t=16}}function k(o){if(B(o)||P(o))return!1;switch(o){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function l(){var o;do o=y();while(o>=12&&o<=15);return o}return{setPosition:N,getPosition:function(){return e},scan:a?l:y,getToken:function(){return t},getTokenValue:function(){return i},getTokenOffset:function(){return u},getTokenLength:function(){return e-u},getTokenStartLine:function(){return s},getTokenStartCharacter:function(){return u-p},getTokenError:function(){return c}}}function B(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function P(r){return r===10||r===13||r===8232||r===8233}function w(r){return r>=48&&r<=57}var L;(function(r){r.DEFAULT={allowTrailingComma:!1}})(L||(L={}));function J(r,a,n){a===void 0&&(a=[]),n===void 0&&(n=L.DEFAULT);var e=null,i=[],u=[];function t(s){Array.isArray(i)?i.push(s):e!==null&&(i[e]=s)}var f={onObjectBegin:function(){var s={};t(s),u.push(i),i=s,e=null},onObjectProperty:function(s){e=s},onObjectEnd:function(){i=u.pop()},onArrayBegin:function(){var s=[];t(s),u.push(i),i=s,e=null},onArrayEnd:function(){i=u.pop()},onLiteralValue:t,onError:function(s,v,p){a.push({error:s,offset:v,length:p})}};return G(r,f,n),i[0]}function G(r,a,n){n===void 0&&(n=L.DEFAULT);var e=H(r,!1);function i(g){return g?function(){return g(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function u(g){return g?function(O){return g(O,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var t=i(a.onObjectBegin),f=u(a.onObjectProperty),s=i(a.onObjectEnd),v=i(a.onArrayBegin),p=i(a.onArrayEnd),c=u(a.onLiteralValue),A=u(a.onSeparator),N=i(a.onComment),D=u(a.onError),S=n&&n.disallowComments,y=n&&n.allowTrailingComma;function k(){for(;;){var g=e.scan();switch(e.getTokenError()){case 4:l(14);break;case 5:l(15);break;case 3:l(13);break;case 1:S||l(11);break;case 2:l(12);break;case 6:l(16);break}switch(g){case 12:case 13:S?l(10):N();break;case 16:l(1);break;case 15:case 14:break;default:return g}}}function l(g,O,E){if(O===void 0&&(O=[]),E===void 0&&(E=[]),D(g),O.length+E.length>0)for(var j=e.getToken();j!==17;){if(O.indexOf(j)!==-1){k();break}else if(E.indexOf(j)!==-1)break;j=k()}}function o(g){var O=e.getTokenValue();return g?c(O):f(O),k(),!0}function b(){switch(e.getToken()){case 11:var g=e.getTokenValue(),O=Number(g);isNaN(O)&&(l(2),O=0),c(O);break;case 7:c(null);break;case 8:c(!0);break;case 9:c(!1);break;default:return!1}return k(),!0}function C(){return e.getToken()!==10?(l(3,[],[2,5]),!1):(o(!1),e.getToken()===6?(A(":"),k(),V()||l(4,[],[2,5])):l(5,[],[2,5]),!0)}function m(){t(),k();for(var g=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(g||l(4,[],[]),A(","),k(),e.getToken()===2&&y)break}else g&&l(6,[],[]);C()||l(4,[],[2,5]),g=!0}return s(),e.getToken()!==2?l(7,[2],[]):k(),!0}function h(){v(),k();for(var g=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(g||l(4,[],[]),A(","),k(),e.getToken()===4&&y)break}else g&&l(6,[],[]);V()||l(4,[],[4,5]),g=!0}return p(),e.getToken()!==4?l(8,[4],[]):k(),!0}function V(){switch(e.getToken()){case 3:return h();case 1:return m();case 10:return o(!0);default:return b()}}return k(),e.getToken()===17?n.allowEmptyContent?!0:(l(4,[],[]),!1):V()?(e.getToken()!==17&&l(9,[],[]),!0):(l(4,[],[]),!1)}var K=J;const F=r=>_(/^[./]/.test(r)?r:`./${r}`);var Q=Object.defineProperty,X=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,W=(r,a,n)=>a in r?Q(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n,T=(r,a)=>{for(var n in a||(a={}))Z.call(a,n)&&W(r,n,a[n]);if(M)for(var n of M(a))x.call(a,n)&&W(r,n,a[n]);return r},ee=(r,a)=>X(r,Y(a));function q(r){var a,n;const e=U.realpathSync(r),i=d.dirname(e),u=U.readFileSync(r,"utf8").trim();let t={};if(u&&(t=K(u),!t||typeof t!="object"))throw new SyntaxError(`Failed to parse JSON: ${r}`);if(t.extends){let f=t.extends;try{f=$.resolve(f,{paths:[d.dirname(r)]})}catch(p){if(p.code==="MODULE_NOT_FOUND")try{f=$.resolve(d.join(f,"tsconfig.json"),{paths:[d.dirname(r)]})}catch{}}const s=q(f);if(delete s.references,(a=s.compilerOptions)!=null&&a.baseUrl){const{compilerOptions:p}=s;p.baseUrl=d.relative(i,d.join(d.dirname(f),p.baseUrl))}s.files&&(s.files=s.files.map(p=>d.relative(i,d.join(d.dirname(f),p)))),s.include&&(s.include=s.include.map(p=>d.relative(i,d.join(d.dirname(f),p)))),delete t.extends;const v=ee(T(T({},s),t),{compilerOptions:T(T({},s.compilerOptions),t.compilerOptions)});s.watchOptions&&(v.watchOptions=T(T({},s.watchOptions),t.watchOptions)),t=v}if((n=t.compilerOptions)!=null&&n.baseUrl){const{compilerOptions:f}=t;f.baseUrl=F(f.baseUrl)}if(t.files&&(t.files=t.files.map(F)),t.include&&(t.include=t.include.map(_)),t.watchOptions){const{watchOptions:f}=t;f.excludeDirectories&&(f.excludeDirectories=f.excludeDirectories.map(s=>_(d.resolve(i,s))))}return t}function re(r=process.cwd(),a="tsconfig.json"){const n=z(r,a);if(!n)return null;const e=q(n);return{path:n,config:e}}const ne=/^\.{1,2}\//,te=/\*/g,R=(r,a)=>{const n=r.match(te);if(n&&n.length>1)throw new Error(a)};function ae(r){if(r.includes("*")){const[a,n]=r.split("*");return{prefix:a,suffix:n}}return r}const oe=({prefix:r,suffix:a},n)=>n.startsWith(r)&&n.endsWith(a);function ie(r,a,n){return Object.entries(r).map(([e,i])=>(R(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:ae(e),substitutions:i.map(u=>{if(R(u,`Substitution '${u}' in pattern '${e}' can have at most one '*' character.`),!u.startsWith("./")&&!a)throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return d.join(n,u)})}))}function se(r){if(!r.config.compilerOptions)return null;const{baseUrl:a,paths:n}=r.config.compilerOptions;if(!a&&!n)return null;const e=d.resolve(d.dirname(r.path),a||"."),i=n?ie(n,a,e):[];return function(t){if(ne.test(t))return[];const f=[];for(const c of i){if(c.pattern===t)return c.substitutions;typeof c.pattern!="string"&&f.push(c)}let s,v=-1;for(const c of f)oe(c.pattern,t)&&c.pattern.prefix.length>v&&(v=c.pattern.prefix.length,s=c);if(!s)return a?[d.join(e,t)]:[];const p=t.slice(s.pattern.prefix.length,t.length-s.pattern.suffix.length);return s.substitutions.map(c=>c.replace("*",p))}}export{se as createPathsMatcher,re as getTsconfig};
